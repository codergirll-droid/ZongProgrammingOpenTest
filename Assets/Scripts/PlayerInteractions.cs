using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PlayerInteractions : MonoBehaviour
{
    GameObject _otherObject;
    ScriptableObjects _objectData;

    UIController _uiController;

    bool _interactKeyPressed = false;

    PlayerController _playerController;

    InventoryManager _inventoryManager;

    private void Start()
    {
        _uiController = UIController.Instance;
        _playerController = PlayerController.Instance;
        _inventoryManager = InventoryManager.Instance;
    }

    private void OnTriggerEnter(Collider other)
    {
        //_objectData = other.GetComponent<Interactable>().data;

        if (other.TryGetComponent(out Interactable interactable))
        {
            _objectData = interactable.data;
        }

        if (_objectData != null)
        {
            _uiController.EditInteractableText(other.transform.gameObject.name);
            _otherObject = other.gameObject;

        }
        else
        {
            _uiController.EditInteractableText("");

        }

    }

    private void OnTriggerStay(Collider other)
    {

        if (_objectData != null)
        {

            if (Input.GetKey(KeyCode.I))
            {
                _interactKeyPressed = true;
                _uiController.EditInteractableText("");

            }
        }
    }

    private void OnTriggerExit(Collider other)
    {

        if (_objectData != null)
        {
            _uiController.EditInteractableText("");

        }
    }

    private void Update()
    {
        if (_interactKeyPressed && _objectData != null)
        {
            PickUpObject();
            _interactKeyPressed = false;
        }
    }


    void PickUpObject()
    {
        _inventoryManager.AddObject(_objectData);
        _otherObject.GetComponent<IInteractable>().PickUpObject();
        _uiController.OpenMainMenu();
        _playerController.DisablePlayerControls(true);
        _objectData = null;
        _otherObject = null;
    }

    
}
