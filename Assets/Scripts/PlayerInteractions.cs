using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PlayerInteractions : MonoBehaviour
{
    GameObject _otherObject;
    ScriptableObjects _objectData;

    UIController _uiController;

    bool _interactKeyPressed = false;

    PlayerController _playerController;

    InventoryManager _inventoryManager;

    private void Start()
    {
        _uiController = UIController.Instance;
        _playerController = PlayerController.Instance;
        _inventoryManager = InventoryManager.Instance;
    }

    private void OnTriggerEnter(Collider other)
    {
        Debug.Log("triggered from " + other.gameObject.name);

        if (other.TryGetComponent(out IInteractable interactable))
        {
            _objectData = interactable.GetData();
        }


        if (_objectData != null)
        {
            _uiController.EditInteractableText(_objectData.objectName);
            _otherObject = other.gameObject;

        }

    }

    private void OnTriggerExit(Collider other)
    {

        if (_objectData != null)
        {
            _uiController.EditInteractableText("");
            Debug.Log("exit");

            _objectData = null;
            _otherObject = null;
        }
    }

    private void Update()
    {

        if (!_interactKeyPressed && _objectData != null && Input.GetKeyDown(KeyCode.I))
        {
            _interactKeyPressed = true;

            _uiController.EditInteractableText("");

            if (_objectData.objectMainType == ScriptableObjects.ObjectMainType.SIMPLE_INTERACTABLE)
            {
                PickUpObject();

            }else if(_objectData.objectMainType == ScriptableObjects.ObjectMainType.BOX)
            {
                DropInTheBox();
            }
            Debug.Log("called once");

        }

        if (Input.GetKeyUp(KeyCode.I))
        {
            _interactKeyPressed = false;

        }
    }


    void PickUpObject()
    {
        _inventoryManager.AddObject(_objectData);
        _otherObject.GetComponent<IInteractable>().PickUpObject();
        _uiController.OpenMainMenu();
        _playerController.DisablePlayerControls(true);
        _objectData = null;
        _otherObject = null;
    }

    void DropInTheBox()
    {
        //open the inventory and select the instrument to drop inside
        _otherObject.GetComponent<Box>().DropObjectInside();
        //delete the object from the list
        //update feedback text
    }
    
}
